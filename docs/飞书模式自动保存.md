# é£ä¹¦æ¨¡å¼è‡ªåŠ¨ä¿å­˜

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

ä¹‹å‰çš„è‡ªåŠ¨ä¿å­˜ç­–ç•¥ä¼šäº§ç”Ÿå¤§é‡ç©ºæ–‡æ¡£å’Œè‰ç¨¿æ–‡æ¡£ï¼Œå¯¼è‡´ï¼š
- âŒ æ–‡ç« åˆ—è¡¨å……æ–¥å¤§é‡æ— ç”¨ç©ºæ–‡æ¡£
- âŒ ç”¨æˆ·ä½“éªŒå·®ï¼Œéš¾ä»¥æ‰¾åˆ°çœŸæ­£çš„æ–‡ç« 
- âŒ æµªè´¹å­˜å‚¨ç©ºé—´

## ğŸ¯ è§£å†³æ–¹æ¡ˆï¼šé£ä¹¦æ¨¡å¼

å‚è€ƒé£ä¹¦æ–‡æ¡£çš„ä¿å­˜ç­–ç•¥ï¼Œå®æ–½**å»¶è¿Ÿåˆ›å»º + æ™ºèƒ½å‡çº§**æœºåˆ¶ã€‚

## æ ¸å¿ƒè®¾è®¡

### 1ï¸âƒ£ ä¸‰é˜¶æ®µæ–‡æ¡£çŠ¶æ€

```typescript
type DocumentStatus = 
  | 'TEMP'      // ä¸´æ—¶çŠ¶æ€ï¼ˆä»…å‰ç«¯ï¼ŒæœªæŒä¹…åŒ–ï¼‰
  | 'DRAFT'     // è‰ç¨¿ï¼ˆå·²æŒä¹…åŒ–ï¼Œå¯èƒ½è¢«æ¸…ç†ï¼‰
  | 'NORMAL'    // æ­£å¼æ–‡æ¡£ï¼ˆä¸ä¼šè¢«æ¸…ç†ï¼‰
```

### 2ï¸âƒ£ çŠ¶æ€è½¬æ¢è§„åˆ™

```
æ–°å»ºæ–‡æ¡£
  â†“
TEMPï¼ˆä¸´æ—¶çŠ¶æ€ï¼‰
  â†“ æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼š
  - å†…å®¹ â‰¥ 30å­— + æ ‡é¢˜éç©º
  - å†…å®¹ â‰¥ 50å­—ï¼ˆå³ä½¿æ ‡é¢˜ä¸ºç©ºï¼‰
  - ç¼–è¾‘æ—¶é•¿ > 3åˆ†é’Ÿ ä¸” å†…å®¹ > 10å­—
  â†“
DRAFTï¼ˆè‰ç¨¿ï¼‰
  â†“ æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼š
  - å†…å®¹ â‰¥ 30å­—
  - æ ‡é¢˜éç©º + å†…å®¹ â‰¥ 10å­—
  - ç¼–è¾‘æ—¶é•¿ > 3åˆ†é’Ÿ
  - ç”¨æˆ·æ‰‹åŠ¨ä¿å­˜
  â†“
NORMALï¼ˆæ­£å¼æ–‡æ¡£ï¼‰
```

### 3ï¸âƒ£ å·®å¼‚åŒ–ä¿å­˜å»¶è¿Ÿ

| çŠ¶æ€ | ä¿å­˜å»¶è¿Ÿ | è¯´æ˜ |
|------|----------|------|
| **TEMP** | 10ç§’ | ç»™ç”¨æˆ·æ›´å¤šæ€è€ƒæ—¶é—´ |
| **DRAFT** | 5ç§’ | é€‚ä¸­çš„ä¿å­˜é¢‘ç‡ |
| **NORMAL** | 3ç§’ | å¿«é€Ÿä¿å­˜ï¼Œé˜²æ­¢ä¸¢å¤± |

## ä¸»è¦åŠŸèƒ½

### 1. å»¶è¿Ÿåˆ›å»ºæœºåˆ¶

**æ ¸å¿ƒé€»è¾‘ï¼ˆ`useAutoSave.ts`ï¼‰ï¼š**

```typescript
function shouldCreateDocument(
  content: string,
  title: string,
  documentStatus: DocumentStatus,
  editStartTime: Date | null
): boolean {
  if (documentStatus !== 'TEMP') return false
  
  const contentLength = content.trim().length
  const hasTitle = title.trim().length > 0

  // æ¡ä»¶1: å†…å®¹ â‰¥ 30å­— + æ ‡é¢˜éç©º
  if (contentLength >= 30 && hasTitle) return true

  // æ¡ä»¶2: å†…å®¹ â‰¥ 50å­—
  if (contentLength >= 50) return true

  // æ¡ä»¶3: ç¼–è¾‘æ—¶é•¿ > 3åˆ†é’Ÿ ä¸” å†…å®¹ > 10å­—
  if (editStartTime && contentLength > 10) {
    const editDuration = Date.now() - editStartTime.getTime()
    if (editDuration > 3 * 60 * 1000) return true
  }

  return false
}
```

### 2. æ™ºèƒ½çŠ¶æ€å‡çº§

**ä» DRAFT åˆ° NORMALï¼š**

```typescript
function shouldUpgradeToNormal(
  content: string,
  title: string,
  documentStatus: DocumentStatus,
  editStartTime: Date | null
): boolean {
  if (documentStatus !== 'DRAFT') return false

  const contentLength = content.trim().length
  const hasTitle = title.trim().length > 0

  // æ¡ä»¶1: å†…å®¹ â‰¥ 30å­—
  if (contentLength >= 30) return true

  // æ¡ä»¶2: æ ‡é¢˜éç©º + å†…å®¹ â‰¥ 10å­—
  if (hasTitle && contentLength >= 10) return true

  // æ¡ä»¶3: ç¼–è¾‘æ—¶é•¿ > 3åˆ†é’Ÿ
  if (editStartTime) {
    const editDuration = Date.now() - editStartTime.getTime()
    if (editDuration > 3 * 60 * 1000) return true
  }

  return false
}
```

### 3. è‰ç¨¿ç®±ç®¡ç†

**æ–‡ç« åˆ—è¡¨ï¼ˆ`Articles.tsx`ï¼‰ï¼š**

- ğŸ“„ **æ­£å¼æ–‡æ¡£**ï¼šé»˜è®¤è§†å›¾ï¼Œåªæ˜¾ç¤º NORMAL çŠ¶æ€çš„æ–‡æ¡£
- ğŸ“ **è‰ç¨¿ç®±**ï¼šåˆ‡æ¢åæ˜¾ç¤º DRAFT çŠ¶æ€çš„æ–‡æ¡£
- ğŸ—‘ï¸ **ä¸€é”®æ¸…ç†**ï¼šæ¸…ç† 24å°æ—¶æœªç¼–è¾‘ ä¸” å†…å®¹<10å­— çš„è‰ç¨¿

```typescript
// æ¸…ç†æ¡ä»¶
const drafts = documents.filter(doc => {
  const wordCount = countWords(doc.content)
  const hasTitle = doc.title && !doc.title.includes('æœªå‘½å')
  const isOld = new Date(doc.updatedAt).getTime() < Date.now() - 24 * 60 * 60 * 1000
  
  return isOld && (wordCount < 10 || !hasTitle)
})
```

### 4. æ–‡æ¡£çŠ¶æ€æŒ‡ç¤ºå™¨

**ç¼–è¾‘å™¨åº•éƒ¨çŠ¶æ€æ ï¼ˆ`Editor.tsx`ï¼‰ï¼š**

| çŠ¶æ€ | å›¾æ ‡ | é¢œè‰² | è¯´æ˜ |
|------|------|------|------|
| **TEMP** | âœï¸ ç¼–è¾‘ä¸­ | è“è‰² | ä¸´æ—¶çŠ¶æ€ï¼Œå†…å®¹è¾¾åˆ°30å­—åè‡ªåŠ¨ä¿å­˜ |
| **DRAFT** | ğŸ“ è‰ç¨¿ | é»„è‰² | è‰ç¨¿çŠ¶æ€ï¼Œå†…å®¹è¾¾åˆ°30å­—åè‡ªåŠ¨è½¬ä¸ºæ­£å¼æ–‡æ¡£ |
| **NORMAL** | âœ“ å·²ä¿å­˜ | ç»¿è‰² | æ­£å¼æ–‡æ¡£ï¼Œå·²è‡ªåŠ¨ä¿å­˜ |

## æŠ€æœ¯å®ç°

### å‰ç«¯çŠ¶æ€ç®¡ç†

**`src/types/app.ts`ï¼š**

```typescript
export interface EditorState {
  // ... å…¶ä»–å­—æ®µ
  documentStatus: DocumentStatus  // å½“å‰æ–‡æ¡£çŠ¶æ€
  documentId: string | null        // å½“å‰æ–‡æ¡£ID
  editStartTime: Date | null       // å¼€å§‹ç¼–è¾‘æ—¶é—´
}
```

**æ–°å¢ Actionsï¼š**

```typescript
| { type: 'SET_DOCUMENT_STATUS'; payload: DocumentStatus }
| { type: 'SET_DOCUMENT_ID'; payload: string | null }
| { type: 'RESET_DOCUMENT'; payload?: { content?: string; title?: string } }
```

### è‡ªåŠ¨ä¿å­˜é’©å­

**`src/hooks/useAutoSave.ts`ï¼š**

- `performSave()`ï¼šæ‰§è¡Œä¿å­˜ï¼ŒåŒ…å«çŠ¶æ€æ£€æŸ¥å’Œå‡çº§é€»è¾‘
- `shouldCreateDocument()`ï¼šåˆ¤æ–­æ˜¯å¦åº”è¯¥åˆ›å»ºæ–‡æ¡£
- `shouldUpgradeToNormal()`ï¼šåˆ¤æ–­æ˜¯å¦åº”è¯¥å‡çº§çŠ¶æ€
- å·®å¼‚åŒ–å»¶è¿Ÿï¼šæ ¹æ®æ–‡æ¡£çŠ¶æ€è®¾ç½®ä¸åŒçš„ä¿å­˜å»¶è¿Ÿ

### æ–‡ç« åˆ—è¡¨ä¼˜åŒ–

**`src/pages/Articles.tsx`ï¼š**

- è§†å›¾åˆ‡æ¢æ ‡ç­¾ï¼ˆæ­£å¼æ–‡æ¡£ / è‰ç¨¿ç®±ï¼‰
- è‰ç¨¿è¿‡æ»¤é€»è¾‘
- ä¸€é”®æ¸…ç†è‰ç¨¿åŠŸèƒ½
- ç»Ÿè®¡å’Œæ˜¾ç¤ºä¼˜åŒ–

## ç”¨æˆ·ä½“éªŒ

### æ–°å»ºæ–‡æ¡£æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»"æ–°å»ºæ–‡æ¡£"
   â†’ ç¼–è¾‘å™¨æ‰“å¼€ï¼ŒçŠ¶æ€ï¼šâœï¸ ç¼–è¾‘ä¸­

2. ç”¨æˆ·å¼€å§‹è¾“å…¥ï¼ˆ< 30å­—ï¼‰
   â†’ çŠ¶æ€ä¿æŒï¼šâœï¸ ç¼–è¾‘ä¸­
   â†’ 10ç§’åè‹¥æœªè¾¾åˆ°ä¿å­˜æ¡ä»¶ï¼Œä¸ä¿å­˜

3. ç”¨æˆ·è¾“å…¥ â‰¥ 30å­— + å¡«å†™æ ‡é¢˜
   â†’ è§¦å‘é¦–æ¬¡ä¿å­˜
   â†’ çŠ¶æ€å˜ä¸ºï¼šğŸ“ è‰ç¨¿
   â†’ åç»­5ç§’å»¶è¿Ÿä¿å­˜

4. ç”¨æˆ·ç»§ç»­ç¼–è¾‘ï¼Œå†…å®¹è´¨é‡æå‡
   â†’ è‡ªåŠ¨å‡çº§çŠ¶æ€ï¼šâœ“ å·²ä¿å­˜
   â†’ åç»­3ç§’å»¶è¿Ÿä¿å­˜
```

### è‰ç¨¿ç®¡ç†æµç¨‹

```
1. ç”¨æˆ·è¿›å…¥"æ–‡ç« ç®¡ç†"
   â†’ é»˜è®¤æ˜¾ç¤ºï¼šğŸ“„ æ­£å¼æ–‡æ¡£

2. ç”¨æˆ·åˆ‡æ¢åˆ°ï¼šğŸ“ è‰ç¨¿ç®±
   â†’ æ˜¾ç¤ºæ‰€æœ‰è‰ç¨¿æ–‡æ¡£
   â†’ æ˜¾ç¤º"æ¸…ç†ç©ºè‰ç¨¿"æŒ‰é’®

3. ç”¨æˆ·ç‚¹å‡»"æ¸…ç†ç©ºè‰ç¨¿"
   â†’ ç³»ç»Ÿæ‰«æï¼š24å°æ—¶æœªç¼–è¾‘ ä¸” å†…å®¹<10å­—
   â†’ æ˜¾ç¤ºå¾…æ¸…ç†æ•°é‡
   â†’ ç”¨æˆ·ç¡®è®¤åæ¸…ç†
```

## ä¼˜åŠ¿æ€»ç»“

### âœ… è§£å†³çš„é—®é¢˜

1. **ä¸å†äº§ç”Ÿå¤§é‡ç©ºæ–‡æ¡£**
   - å»¶è¿Ÿåˆ›å»ºæœºåˆ¶ç¡®ä¿åªä¿å­˜æœ‰æ„ä¹‰çš„å†…å®¹
   
2. **ç”¨æˆ·ä½“éªŒæ›´æµç•…**
   - çŠ¶æ€æŒ‡ç¤ºå™¨æä¾›å³æ—¶åé¦ˆ
   - å·®å¼‚åŒ–å»¶è¿Ÿé€‚åº”ä¸åŒç¼–è¾‘é˜¶æ®µ
   
3. **æ–‡ç« åˆ—è¡¨æ›´æ¸…æ™°**
   - é»˜è®¤éšè—è‰ç¨¿
   - è‰ç¨¿ç®±ç»Ÿä¸€ç®¡ç†
   - ä¸€é”®æ¸…ç†ç©ºè‰ç¨¿

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- å‡å°‘ä¸å¿…è¦çš„æ•°æ®åº“å†™å…¥
- æœ¬åœ°çŠ¶æ€ç®¡ç†ä¼˜å…ˆ
- å¼‚æ­¥ä¿å­˜ä¸é˜»å¡ç¼–è¾‘

### ğŸ¯ ä¸“ä¸šçº§ä¿å­˜ç­–ç•¥

- å‚è€ƒé£ä¹¦æ–‡æ¡£çš„æˆç†Ÿæ–¹æ¡ˆ
- ç¬¦åˆç”¨æˆ·é¢„æœŸçš„è¡Œä¸ºæ¨¡å¼
- æ¸…æ™°çš„çŠ¶æ€ç®¡ç†å’Œåé¦ˆ

## æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶

```
src/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ app.ts                    # æ·»åŠ  DocumentStatus ç±»å‹
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ app-context.tsx           # æ·»åŠ çŠ¶æ€ç®¡ç† actions
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useAutoSave.ts            # æ ¸å¿ƒä¿å­˜é€»è¾‘ï¼ˆå®Œå…¨é‡å†™ï¼‰
â”œâ”€â”€ components/
â”‚   â””â”€â”€ Editor.tsx                # æ·»åŠ çŠ¶æ€æŒ‡ç¤ºå™¨
â””â”€â”€ pages/
    â””â”€â”€ Articles.tsx              # æ·»åŠ è‰ç¨¿ç®±å’Œæ¸…ç†åŠŸèƒ½

styles/
â”œâ”€â”€ App.css                       # çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼
â””â”€â”€ articles.css                  # è‰ç¨¿ç®±å’Œæ¸…ç†æŒ‰é’®æ ·å¼
```

## åç»­ä¼˜åŒ–

### å¯é€‰åŠŸèƒ½

1. **è‡ªåŠ¨æ¸…ç†å®šæ—¶ä»»åŠ¡**
   - åå°å®šæ—¶æ¸…ç†æ—§è‰ç¨¿
   - å¯é…ç½®æ¸…ç†å‘¨æœŸ

2. **è‰ç¨¿ç®±ç»Ÿè®¡**
   - æ˜¾ç¤ºè‰ç¨¿æ•°é‡
   - è‰ç¨¿å ç”¨ç©ºé—´

3. **çŠ¶æ€è½¬æ¢é€šçŸ¥**
   - DRAFT â†’ NORMAL æ—¶è½»é‡æç¤º
   - å¯é…ç½®æ˜¯å¦æ˜¾ç¤º

4. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡å‡çº§è‰ç¨¿
   - æ‰¹é‡å½’æ¡£æ–‡æ¡£

## æ€»ç»“

é€šè¿‡å®æ–½é£ä¹¦æ¨¡å¼çš„è‡ªåŠ¨ä¿å­˜ç­–ç•¥ï¼Œæˆ‘ä»¬ï¼š

âœ… **è§£å†³äº†ç©ºæ–‡æ¡£é—®é¢˜**  
âœ… **æå‡äº†ç”¨æˆ·ä½“éªŒ**  
âœ… **ä¼˜åŒ–äº†å­˜å‚¨æ•ˆç‡**  
âœ… **æä¾›äº†ä¸“ä¸šçš„æ–‡æ¡£ç®¡ç†**

è¿™æ˜¯ä¸€ä¸ªä»æ ¹æœ¬ä¸Šè§£å†³è‡ªåŠ¨ä¿å­˜é—®é¢˜çš„å®Œæ•´æ–¹æ¡ˆï¼
